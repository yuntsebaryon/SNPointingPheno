#!/usr/bin/env python
import numpy as np
import os

if __name__ == "__main__":

    outDir = '/Users/yuntse/data/lartpc_rd/gampix/sn/garching/nh/marley_gt'
    jsonDir = f'{outDir}/json'
    nFiles = 1
    nEvtsPerFile = 1000
    fileName = 'nueArCC_garching_nh_gt_mxpyDir'
    reactName = 've40ArCC_Bhattacharya2009_gt'

    for iFile in range( nFiles ):

        seed = np.random.randint(0, 2**32, dtype = np.uint32)
        jsonF = f'{jsonDir}/{fileName}_{iFile:02d}.js'
        with open( jsonF, 'w') as f:
            f.write(
f'''
{{
  seed: {seed},
  direction: {{ x: -1.0, y: 1.0, z: 0.0 }},
  target: {{
    nuclides: [ 1000180400 ],
    atom_fractions: [ 1.0 ],
  }},
  reactions: [ "{reactName}.react" ],
  source: {{
    type: "histogram",
    neutrino: "ve",
    E_bin_lefts: [ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12.,
       13., 14., 15., 16., 17., 18., 19., 20., 21., 22., 23., 24., 25.,
       26., 27., 28., 29., 30., 31., 32., 33., 34., 35., 36., 37., 38.,
       39., 40., 41., 42., 43., 44., 45., 46., 47., 48., 49., 50., 51.,
       52., 53., 54., 55., 56., 57., 58., 59., 60., 61., 62., 63., 64.,
       65., 66., 67., 68., 69., 70., 71., 72., 73., 74., 75., 76., 77.,
       78., 79., 80., 81., 82., 83., 84., 85., 86., 87., 88., 89., 90.,
       91., 92., 93., 94., 95., 96., 97., 98., 99.],
    weights: [12.17719013358, 107.95830798400002, 274.34024718,
       454.1517404499999, 610.91117862, 728.08780956, 802.05931838,
       836.2711492, 837.3735298, 812.9236587, 770.1434389, 715.3298738,
       653.6461348, 589.1242101, 524.7717353, 462.72361968999996,
       404.40229585, 350.66921012999995, 301.95852851000006,
       258.38996091999996, 219.86080774, 186.11902274000002, 156.81954938,
       131.56692354, 109.94602059, 91.54413692, 75.965526047,
       62.840810201, 51.832204476, 42.635805919999996, 34.981795124,
       28.633302851200003, 23.384351055200003, 19.0572859817,
       15.4999789782, 12.58298288302, 10.19677636952, 8.24916439195,
       6.662888016079999, 5.37348086352, 4.327349522601,
       3.4800990503080005, 2.7950711677670004, 2.242084298349,
       1.796360723328, 1.4376083306885001, 1.1492503507103,
       0.9177745550976999, 0.7321899222338001, 0.58357362206816,
       0.46469575396954993, 0.36970789816630995, 0.29388725543176997,
       0.23342586902241, 0.185257956533357, 0.146918685024692,
       0.11642910744277299, 0.092202363432176, 0.07296742826649619,
       0.057707620047068794, 0.045610399990602395, 0.0360272226523565,
       0.028440855139431502, 0.022439230102561616, 0.017694355972114318,
       0.01394539438138351, 0.010985084677311569, 0.008648875273575383,
       0.0068062220778169966, 0.005353643187120879, 0.004209161440521257,
       0.003307885128191702, 0.0025984822505382994, 0.002040369933075624,
       0.0016014857344219722, 0.0012565137131231936,
       0.0009854763354829054, 0.0007726173003826866,
       0.0006055172121672111, 0.0004743911630671957,
       0.0003715341420036108, 0.0002908820057958534,
       0.00022766423890950327, 0.00017812961587549667,
       0.00013932993276207582, 0.00010894894392849528,
       8.516773699565274e-05, 6.655855976647217e-05,
       5.2001089441602825e-05, 4.061660194918545e-05,
       3.171613310089716e-05, 2.4759674462136333e-05,
       1.9324154973393788e-05, 1.507819814490339e-05,
       1.1762352056813657e-05, 9.17354177936656e-06,
       7.152872337427121e-06, 5.576047472679079e-06, 4.34587685783222e-06,
       3.386376747086882e-06],
    Emax: 100.,
  }},
  executable_settings: {{
    events: {nEvtsPerFile}, 
    output: [ {{ file: "{outDir}/{fileName}_{iFile:02d}.hepevt", format: "hepevt", mode: "overwrite" }} ],
  }},
}}
'''
)

        cmd = f'marley {jsonF}'
        os.system( cmd )
