#!/usr/bin/env python
import numpy as np
import os

if __name__ == "__main__":

    transition = 'fermi'
    outDir = f'/Users/yuntse/data/supernova/gkvm/marley_{transition}'
    jsonDir = f'{outDir}/json'
    nFiles = 1
    nEvtsPerFile = 10000
    fileName = f'nueArCC_garching_nh_{transition}_nxpyDir'
    reactName = f've40ArCC_Bhattacharya2009_{transition}'

    if os.path.exists( jsonDir ):
        raise FileExistsError(f"Output directory '{jsonDir}' already exists.")
    else:
        os.makedirs( jsonDir )

    for iFile in range( nFiles ):

        seed = np.random.randint(0, 2**32, dtype = np.uint32)
        jsonF = f'{jsonDir}/{fileName}_{iFile:02d}.js'
        with open( jsonF, 'w') as f:
            f.write(
f'''
{{
  seed: {seed},
  direction: {{ x: -1.0, y: 1.0, z: 0.0 }},
  target: {{
    nuclides: [ 1000180400 ],
    atom_fractions: [ 1.0 ],
  }},
  reactions: [ "{reactName}.react" ],
  source: {{
    type: "histogram",
    neutrino: "ve",
    E_bin_lefts: [  0.2,   0.4,   0.6,   0.8,   1. ,   1.2,   1.4,   1.6,   1.8,
         2. ,   2.2,   2.4,   2.6,   2.8,   3. ,   3.2,   3.4,   3.6,
         3.8,   4. ,   4.2,   4.4,   4.6,   4.8,   5. ,   5.2,   5.4,
         5.6,   5.8,   6. ,   6.2,   6.4,   6.6,   6.8,   7. ,   7.2,
         7.4,   7.6,   7.8,   8. ,   8.2,   8.4,   8.6,   8.8,   9. ,
         9.2,   9.4,   9.6,   9.8,  10. ,  10.2,  10.4,  10.6,  10.8,
        11. ,  11.2,  11.4,  11.6,  11.8,  12. ,  12.2,  12.4,  12.6,
        12.8,  13. ,  13.2,  13.4,  13.6,  13.8,  14. ,  14.2,  14.4,
        14.6,  14.8,  15. ,  15.2,  15.4,  15.6,  15.8,  16. ,  16.2,
        16.4,  16.6,  16.8,  17. ,  17.2,  17.4,  17.6,  17.8,  18. ,
        18.2,  18.4,  18.6,  18.8,  19. ,  19.2,  19.4,  19.6,  19.8,
        20. ,  20.2,  20.4,  20.6,  20.8,  21. ,  21.2,  21.4,  21.6,
        21.8,  22. ,  22.2,  22.4,  22.6,  22.8,  23. ,  23.2,  23.4,
        23.6,  23.8,  24. ,  24.2,  24.4,  24.6,  24.8,  25. ,  25.2,
        25.4,  25.6,  25.8,  26. ,  26.2,  26.4,  26.6,  26.8,  27. ,
        27.2,  27.4,  27.6,  27.8,  28. ,  28.2,  28.4,  28.6,  28.8,
        29. ,  29.2,  29.4,  29.6,  29.8,  30. ,  30.2,  30.4,  30.6,
        30.8,  31. ,  31.2,  31.4,  31.6,  31.8,  32. ,  32.2,  32.4,
        32.6,  32.8,  33. ,  33.2,  33.4,  33.6,  33.8,  34. ,  34.2,
        34.4,  34.6,  34.8,  35. ,  35.2,  35.4,  35.6,  35.8,  36. ,
        36.2,  36.4,  36.6,  36.8,  37. ,  37.2,  37.4,  37.6,  37.8,
        38. ,  38.2,  38.4,  38.6,  38.8,  39. ,  39.2,  39.4,  39.6,
        39.8,  40. ,  40.2,  40.4,  40.6,  40.8,  41. ,  41.2,  41.4,
        41.6,  41.8,  42. ,  42.2,  42.4,  42.6,  42.8,  43. ,  43.2,
        43.4,  43.6,  43.8,  44. ,  44.2,  44.4,  44.6,  44.8,  45. ,
        45.2,  45.4,  45.6,  45.8,  46. ,  46.2,  46.4,  46.6,  46.8,
        47. ,  47.2,  47.4,  47.6,  47.8,  48. ,  48.2,  48.4,  48.6,
        48.8,  49. ,  49.2,  49.4,  49.6,  49.8,  50. ,  50.2,  50.4,
        50.6,  50.8,  51. ,  51.2,  51.4,  51.6,  51.8,  52. ,  52.2,
        52.4,  52.6,  52.8,  53. ,  53.2,  53.4,  53.6,  53.8,  54. ,
        54.2,  54.4,  54.6,  54.8,  55. ,  55.2,  55.4,  55.6,  55.8,
        56. ,  56.2,  56.4,  56.6,  56.8,  57. ,  57.2,  57.4,  57.6,
        57.8,  58. ,  58.2,  58.4,  58.6,  58.8,  59. ,  59.2,  59.4,
        59.6,  59.8,  60. ,  60.2,  60.4,  60.6,  60.8,  61. ,  61.2,
        61.4,  61.6,  61.8,  62. ,  62.2,  62.4,  62.6,  62.8,  63. ,
        63.2,  63.4,  63.6,  63.8,  64. ,  64.2,  64.4,  64.6,  64.8,
        65. ,  65.2,  65.4,  65.6,  65.8,  66. ,  66.2,  66.4,  66.6,
        66.8,  67. ,  67.2,  67.4,  67.6,  67.8,  68. ,  68.2,  68.4,
        68.6,  68.8,  69. ,  69.2,  69.4,  69.6,  69.8,  70. ,  70.2,
        70.4,  70.6,  70.8,  71. ,  71.2,  71.4,  71.6,  71.8,  72. ,
        72.2,  72.4,  72.6,  72.8,  73. ,  73.2,  73.4,  73.6,  73.8,
        74. ,  74.2,  74.4,  74.6,  74.8,  75. ,  75.2,  75.4,  75.6,
        75.8,  76. ,  76.2,  76.4,  76.6,  76.8,  77. ,  77.2,  77.4,
        77.6,  77.8,  78. ,  78.2,  78.4,  78.6,  78.8,  79. ,  79.2,
        79.4,  79.6,  79.8,  80. ,  80.2,  80.4,  80.6,  80.8,  81. ,
        81.2,  81.4,  81.6,  81.8,  82. ,  82.2,  82.4,  82.6,  82.8,
        83. ,  83.2,  83.4,  83.6,  83.8,  84. ,  84.2,  84.4,  84.6,
        84.8,  85. ,  85.2,  85.4,  85.6,  85.8,  86. ,  86.2,  86.4,
        86.6,  86.8,  87. ,  87.2,  87.4,  87.6,  87.8,  88. ,  88.2,
        88.4,  88.6,  88.8,  89. ,  89.2,  89.4,  89.6,  89.8,  90. ,
        90.2,  90.4,  90.6,  90.8,  91. ,  91.2,  91.4,  91.6,  91.8,
        92. ,  92.2,  92.4,  92.6,  92.8,  93. ,  93.2,  93.4,  93.6,
        93.8,  94. ,  94.2,  94.4,  94.6,  94.8,  95. ,  95.2,  95.4,
        95.6,  95.8,  96. ,  96.2,  96.4,  96.6,  96.8,  97. ,  97.2,
        97.4,  97.6,  97.8,  98. ,  98.2,  98.4,  98.6,  98.8,  99. ,
        99.2,  99.4,  99.6,  99.8, 100. ],
    weights: [6048400.0, 15294300.0, 30226800.0, 46871000.0, 67923600.0,
       89673900.0, 117125000.0, 144883000.0, 172539000.0, 202829000.0,
       238289000.0, 272550000.0, 304353000.0, 338024000.0, 374213000.0,
       410756000.0, 447320000.0, 484162000.0, 520046000.0, 554125000.0,
       587410000.0, 621027000.0, 654818000.0, 687849000.0, 719593000.0,
       750088000.0, 779300000.0, 807056000.0, 833413000.0, 858720000.0,
       883100000.0, 906238000.0, 927847000.0, 947893000.0, 965471000.0,
       973718000.0, 949172000.0, 874365000.0, 796523000.0, 756375000.0,
       742407000.0, 739477000.0, 741415000.0, 746173000.0, 752902000.0,
       760952000.0, 769609000.0, 778301000.0, 786663000.0, 794512000.0,
       801746000.0, 808346000.0, 814313000.0, 819654000.0, 824336000.0,
       828401000.0, 831888000.0, 834743000.0, 837056000.0, 838767000.0,
       839959000.0, 840580000.0, 840713000.0, 840329000.0, 839439000.0,
       838102000.0, 836297000.0, 834042000.0, 831359000.0, 828280000.0,
       824808000.0, 820966000.0, 816747000.0, 812186000.0, 807310000.0,
       802114000.0, 796613000.0, 790846000.0, 784804000.0, 778506000.0,
       771982000.0, 765220000.0, 758259000.0, 751096000.0, 743751000.0,
       736237000.0, 728562000.0, 720744000.0, 712789000.0, 704713000.0,
       696523000.0, 688234000.0, 679852000.0, 671390000.0, 662856000.0,
       654263000.0, 645613000.0, 636921000.0, 628193000.0, 619434000.0,
       610661000.0, 601867000.0, 593072000.0, 584279000.0, 575485000.0,
       566713000.0, 557960000.0, 549222000.0, 540526000.0, 531863000.0,
       523230000.0, 514654000.0, 506126000.0, 497642000.0, 489218000.0,
       480866000.0, 472566000.0, 464327000.0, 456176000.0, 448093000.0,
       440072000.0, 432137000.0, 424290000.0, 416520000.0, 408822000.0,
       401210000.0, 393700000.0, 386270000.0, 378905000.0, 371635000.0,
       364466000.0, 357374000.0, 350352000.0, 343415000.0, 336566000.0,
       329803000.0, 323117000.0, 316384000.0, 311102000.0, 304509000.0,
       298129000.0, 291806000.0, 285539000.0, 279355000.0, 273270000.0,
       267273000.0, 261352000.0, 255505000.0, 249742000.0, 244072000.0,
       238495000.0, 233014000.0, 227622000.0, 222314000.0, 217085000.0,
       211946000.0, 206913000.0, 201984000.0, 197142000.0, 192376000.0,
       187689000.0, 183095000.0, 178598000.0, 174197000.0, 169891000.0,
       165668000.0, 161525000.0, 157459000.0, 153477000.0, 149580000.0,
       145773000.0, 142058000.0, 138431000.0, 134881000.0, 131400000.0,
       127987000.0, 124646000.0, 121383000.0, 118196000.0, 115083000.0,
       112040000.0, 109064000.0, 106153000.0, 103302000.0, 100506000.0,
       97763400.0, 95071400.0, 92429300.0, 89837400.0, 87298400.0,
       84811900.0, 82376100.0, 79985700.0, 77636900.0, 75327700.0,
       73057800.0, 70826700.0, 68631800.0, 66471600.0, 64344900.0,
       62253500.0, 60201200.0, 58191600.0, 56227100.0, 54310300.0,
       52439600.0, 50613200.0, 48828100.0, 47080500.0, 45368800.0,
       43693100.0, 42055900.0, 40461700.0, 38913900.0, 37415200.0,
       35968000.0, 34570800.0, 33224500.0, 31927900.0, 30678800.0,
       29476600.0, 28317600.0, 27200500.0, 26123000.0, 25084100.0,
       24083700.0, 23121500.0, 22198100.0, 21313500.0, 20467700.0,
       19660500.0, 18891200.0, 18158600.0, 17460900.0, 16795500.0,
       16160100.0, 15552900.0, 14971300.0, 14414100.0, 13880100.0,
       13368700.0, 12879300.0, 12410800.0, 11962700.0, 11534300.0,
       11125100.0, 10734300.0, 10361400.0, 10005700.0, 9666220.0,
       9342290.0, 9032680.0, 8736420.0, 8452310.0, 8179380.0, 7916890.0,
       7664090.0, 7420500.0, 7185690.0, 6959450.0, 6741650.0, 6532280.0,
       6331210.0, 6138360.0, 5953550.0, 5776460.0, 5606550.0, 5443290.0,
       5286020.0, 5134110.0, 4987030.0, 4844300.0, 4705640.0, 4570980.0,
       4440200.0, 4313380.0, 4190650.0, 4072070.0, 3957560.0, 3847170.0,
       3740670.0, 3638030.0, 3538960.0, 3443210.0, 3350560.0, 3260670.0,
       3173380.0, 3088470.0, 3005830.0, 2925310.0, 2846830.0, 2770400.0,
       2696000.0, 2623600.0, 2553300.0, 2485050.0, 2418830.0, 2354550.0,
       2292210.0, 2231630.0, 2172880.0, 2115690.0, 2060090.0, 2005950.0,
       1953180.0, 1901810.0, 1851760.0, 1802990.0, 1755580.0, 1709470.0,
       1664630.0, 1621070.0, 1578770.0, 1537670.0, 1497720.0, 1458600.0,
       1422650.0, 1388400.0, 1351320.0, 1306650.0, 1274340.0, 1234390.0,
       1210880.0, 1191770.0, 1176560.0, 1107080.0, 1108480.0, 1074100.0,
       1078230.0, 1012570.0, 983074.0, 966951.0, 938692.0, 909835.0,
       885377.0, 869031.0, 836361.0, 838639.0, 797232.0, 779336.0,
       751730.0, 732877.0, 698192.0, 704457.0, 682560.0, 659754.0,
       649575.0, 622363.0, 614981.0, 596243.0, 578501.0, 560357.0,
       536465.0, 537026.0, 517308.0, 503929.0, 489068.0, 479562.0,
       459238.0, 448622.0, 439958.0, 433603.0, 415810.0, 403957.0,
       395879.0, 385081.0, 374626.0, 362461.0, 351017.0, 343672.0,
       332549.0, 326143.0, 315942.0, 307685.0, 299212.0, 285477.0,
       284144.0, 276067.0, 266546.0, 261931.0, 254006.0, 246385.0,
       240805.0, 231236.0, 226299.0, 219167.0, 211873.0, 209293.0,
       202856.0, 191253.0, 191101.0, 187047.0, 179732.0, 176320.0,
       170814.0, 166152.0, 162065.0, 158242.0, 152831.0, 147477.0,
       145610.0, 140472.0, 136417.0, 132284.0, 129384.0, 124842.0,
       122960.0, 117973.0, 114248.0, 111762.0, 108193.0, 105409.0,
       102981.0, 98534.0, 96511.7, 94123.6, 90764.8, 89077.8, 85538.3,
       84047.4, 81860.4, 78294.5, 77379.5, 75425.9, 72101.6, 69622.0,
       68291.3, 66916.1, 65392.3, 63701.7, 61725.6, 60094.8, 58046.0,
       55926.7, 53928.3, 52928.4, 51599.7, 50539.9, 48321.6, 46725.2,
       46394.9, 43891.9, 43336.9, 41779.1, 40623.0, 39337.5, 38348.5,
       36765.0, 36549.4, 35034.6, 33801.6, 33369.4, 32184.1, 30695.1,
       29834.5, 29458.1, 28529.9, 27421.4, 27027.0, 26099.9, 24960.1,
       24853.4, 23470.1, 23451.4, 22104.8, 22040.6, 20975.9, 20484.4,
       20206.7, 19098.7, 18795.5, 18553.0, 17728.5, 16946.3, 16580.1,
       16381.9, 15970.2, 15520.6, 14911.7, 14477.7, 13994.2, 13556.1,
       13233.0, 12882.0, 12595.6, 12225.6, 11828.0, 11302.4, 10830.6,
       10597.2, 10506.4, 10150.3, 9614.96, 9448.02, 9323.97, 8771.75,
       8679.77, 8429.01, 8024.43, 8007.71],
    Emax: 100.2,
  }},
  executable_settings: {{
    events: {nEvtsPerFile}, 
    output: [ {{ file: "{outDir}/{fileName}_{iFile:02d}.hepevt", format: "hepevt", mode: "overwrite" }} ],
  }},
}}
'''
)

        cmd = f'marley {jsonF}'
        os.system( cmd )
